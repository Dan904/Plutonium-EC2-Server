# 161109 nginx rerwrite


user  				nginx;
worker_processes  		auto;
error_log			/var/log/nginx/main.error.log;
pid				/var/run/nginx.pid;

load_module "/usr/lib64/nginx/modules/ngx_http_geoip_module.so";

events {
    	worker_connections  	1024;
    	multi_accept		on;
    	use			epoll;
}


http {
    	include       		mime.types;
    	include			/etc/nginx/conf.d/server.conf;
    	include 		/etc/nginx/conf.d/php-fpm.conf;
    	default_type  		application/octet-stream;

    	log_format  		main  '$remote_addr - $remote_user [$time_local] "$request" '
                      		'$status $body_bytes_sent "$http_referer" '
                      		'"$http_user_agent" "$http_x_forwarded_for"';

    	access_log  		/var/log/nginx/access.log  main;
	error_log		/var/log/nginx/http.error.log error;
	
	upstream php {
		server unix:/tmp/php-fpm.sock;
	}

    	geoip_country /usr/share/GeoIP/GeoIP.dat;
    	map $geoip_country_code $allowed_country {
        	default no;
        	US yes;
    	}	

    	include /etc/nginx/sites/site1.conf;
    	include /etc/nginx/sites/site2.conf;
#    include /etc/nginx/conf.d/site3.conf;

#  server {
#	listen			*:80;
#	listen			[::]:80;
#	listen			*:443 ssl http2;
#	listen			[::]:443 ssl http2;
#
#        server_name  		www.plutopro.xyz *.plutopro.xyz;
#        root         		/var/www/html/site1;
#	index 			index.php;
#
#
#
#	keepalive_timeout 	70;
#	
#	if ($scheme = http) {
#    		return 301 https://$server_name$request_uri;
#	}
#
#
#	include global/restrictions.conf;
#
#
#
#
#        ssl_certificate "/etc/letsencrypt/live/www.plutopro.xyz/fullchain.pem";
#        ssl_certificate_key "/etc/letsencrypt/live/www.plutopro.xyz/privkey.pem";
#        ssl_dhparam "/etc/pki/nginx/dhparams.pem";
#        ssl_session_cache shared:SSL:50m;
#        ssl_session_timeout  5m;
#        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
#	ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';
#        ssl_prefer_server_ciphers on;
#
#	ssl_stapling on;
#	ssl_stapling_verify on;
#
#
#
#        # Load configuration files for the default server block.
#        include /etc/nginx/default.d/*.conf;
#
#        location ~ \.php$ {
#		try_files $uri =404;
#                include fastcgi.conf;
#                fastcgi_pass unix:/var/run/php-fpm/php-fpm.sock;
#        }
#
#	location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
#                expires max;
#                log_not_found off;
#        }
#
#        location / {
#       		try_files $uri $uri/ /index.php?$args;
#	}
#
#    }

}
